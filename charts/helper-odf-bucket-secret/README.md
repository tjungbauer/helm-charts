

# helper-odf-bucket-secret

  [![Artifact Hub](https://img.shields.io/endpoint?url=https://artifacthub.io/badge/repository/openshift-bootstraps)](https://artifacthub.io/packages/search?repo=openshift-bootstraps)
  [![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
  [![Lint and Test Charts](https://github.com/tjungbauer/helm-charts/actions/workflows/lint_and_test_charts.yml/badge.svg)](https://github.com/tjungbauer/helm-charts/actions/workflows/lint_and_test_charts.yml)
  [![Release Charts](https://github.com/tjungbauer/helm-charts/actions/workflows/release.yml/badge.svg)](https://github.com/tjungbauer/helm-charts/actions/workflows/release.yml)

  ![Version: 1.0.1](https://img.shields.io/badge/Version-1.0.1-informational?style=flat-square)

 

  ## Description

  Some services like Tempo require a secret with a specifc key for the object sotrage. When a S3 bucket is created via OpenShift Data Foundation, then this chart will help to generate a correct secret. (This is an evolution of helper-loki-bucket-secret)

This Helm Chart is required when you create a Bucket via Open Data Foundation and the service that wants to use this bucket
requires a secret object with specific keys (i.g. Loki or Tempo)
The bucket in our case is created by OpenShift Data Foundation. ODF will create a Secret and a ConfigMap using the name of the Bucket. The Chart will then create a Job, that mounts the Secret and Configmap and creates a new Secret with the required keys.

This chart is an evolution of *helper-loki-bucket-secret* and was created to be more generic (because of TempoStack requires a different Secret than Loki ....)

The keys are:

1. access_key_id
2. access_key_secret
3. bucketnames
4. endpoint
5. region

## Dependencies

This chart has the following dependencies:

| Repository | Name | Version |
|------------|------|---------|
| https://charts.stderr.at/ | tpl | ~1.0.22 |

It is best used with a full GitOps approach such as Argo CD does. For example, https://github.com/tjungbauer/openshift-clusterconfig-gitops (see clusters/management-cluster/setup-openshift-logging)

## Maintainers

| Name | Email | Url |
| ---- | ------ | --- |
| tjungbauer | <tjungbau@redhat.com> | <https://blog.stderr.at/> |

## Sources
Source:
* <https://github.com/tjungbauer/helm-charts>
* <https://charts.stderr.at/>
* <https://github.com/tjungbauer/openshift-clusterconfig-gitops>

Source code: https://github.com/tjungbauer/helm-charts/tree/main/charts/helper-odf-bucket-secret

## Parameters

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| bucket.name | string | `"bucket-name"` | Name of the Bucket shall has been created. |
| enabled | bool | false | Enable Job to create a Secret for LokiStack. |
| keys | object | `{"access_key_id":"access_key_id","access_key_secret":"access_key_secret","bucket":"bucket","endpoint":"endpoint","region":"region"}` | Keys that shall be used to create the Secret. |
| keys.access_key_id | string | access_key_id | Overwrite access_key_id key. |
| keys.access_key_secret | string | access_key_secret | Overwrite access_key_secret key. |
| keys.bucket | string | bucket | Overwrite bucket key. |
| keys.endpoint | string | endpoint | Overwrite endpoint key. |
| keys.region | string | region | Overwrite region key. Region is only set if set_region is true. |
| namespace | string | `"namespace-with-lokistack-and-bucket"` | Namespace where LokiStack is deployed and where the Secret shall be created. |
| secretname | string | `"secretname-to-create"` | Name of Secret that shall be created. |
| set_region | bool | false | Set region key. |
| syncwave | int | 3 | Syncwave for Argo CD. |

## Example values

```yaml
---
# -- Enable Job to create a Secret for LokiStack.
# @default -- false
enabled: true

# -- Syncwave for Argo CD.
# @default -- 3
syncwave: 3

# -- Namespace where LokiStack is deployed and where the Secret shall be created.
namespace: namespace-with-lokistack-and-bucket

# -- Name of Secret that shall be created.
secretname: secretname-to-create

# Bucket Configuration
bucket:
  # -- Name of the Bucket shall has been created.
  name: bucket-name
```

## Installing the Chart

To install the chart with the release name `my-release`:

```console
helm install my-release tjungbauer/<chart-name>>
```

The command deploys the chart on the Kubernetes cluster in the default configuration.

## Uninstalling the Chart

To uninstall/delete the my-release deployment:

```console
helm delete my-release
```

The command removes all the Kubernetes components associated with the chart and deletes the release.

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.14.2](https://github.com/norwoodj/helm-docs/releases/v1.14.2)
